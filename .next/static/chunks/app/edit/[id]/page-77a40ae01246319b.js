(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[416],{1441:function(e,t,a){Promise.resolve().then(a.bind(a,4084))},4084:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return S}});var r=a(3827),i=a(4090),n=a(7907),s=a(8876),o=a(9125),l=a(4032),c=a(7856),d=a(3383),p=a(7305),u=a(1907),m=a(5550),h=a(7142),g=a(656),j=a(5087),f=a(7363),x=a(8200),b=a(5702),v=a(1129),y=a(2310),w=a(3898);function S(){let e=(0,n.useParams)(),t=(0,n.useRouter)(),[a,S]=(0,i.useState)(!0),[k,Z]=(0,i.useState)(!0),[N,E]=(0,i.useState)(0),[O,z]=(0,i.useState)("horizontal"),[D,M]=(0,i.useState)({name:"",tags:[],description:"",thumbnail:null,media:[],existingThumbnail:"",existingMedia:[],originalMedia:[]}),[P,T]=(0,i.useState)([]),[A,C]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{let a=localStorage.getItem("token");if(!a){t.push("/login");return}try{if(!(await fetch("".concat(w.v.apiUrl,"/api/auth/validateOwner?id=").concat(e.id),{method:"GET",headers:{Authorization:"Bearer ".concat(a)}})).ok)throw Error("Invalid token");S(!1)}catch(e){t.push("/login")}})()},[t]),(0,i.useEffect)(()=>{let t=async()=>{let t=localStorage.getItem("token");try{let a=await fetch("".concat(w.v.apiUrl,"/api/project/edit?id=").concat(e.id),{headers:{Authorization:"Bearer ".concat(t)}});if(!a.ok)throw Error("Failed to fetch project");let r=await a.json();console.log("Received data:",r),M({name:r.name||"",description:r.description||"",tags:r.tags?"string"==typeof r.tags?JSON.parse(r.tags):r.tags:[],thumbnail:null,media:[],existingThumbnail:r.thumbnail?r.thumbnail.replace(/\\/g,"/"):"",existingMedia:r.media?("string"==typeof r.media?JSON.parse(r.media):r.media).map(e=>e.replace(/\\/g,"/")):[],originalMedia:r.media?("string"==typeof r.media?JSON.parse(r.media):r.media).map(e=>e.replace(/\\/g,"/")):[]}),r.tags&&"object"==typeof r.tags&&!Array.isArray(r.tags)&&(r.tags=Object.values(r.tags)),r.tags&&"object"==typeof r.tags&&!Array.isArray(r.tags)&&(r.tags=Object.values(r.tags)),Z(!1)}catch(e){console.error("Fetch error:",e),T([e instanceof Error?e.message:"Failed to fetch project"]),Z(!1)}};!a&&e.id&&t()},[a,e.id]),(0,i.useEffect)(()=>{let e=()=>{z(window.innerWidth<600?"vertical":"horizontal")};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let F=["N\xe1zev","Popis","Thumbnail","Media","Uk\xe1zka"],U=async()=>{if(!A)try{var a;C(!0);let r=(0,v.Ow)(D);if(r.length>0){T(r),C(!1);return}let i=localStorage.getItem("token");if(!i){t.push("/login");return}let n=new FormData;n.append("name",D.name),n.append("description",D.description),n.append("tags",JSON.stringify(D.tags||[]));let s=null!==D.thumbnail;n.append("changedThumbnail",String(s)),D.thumbnail&&n.append("thumbnail",D.thumbnail);let o=(D.originalMedia||[]).filter(e=>!(D.existingMedia||[]).includes(e));n.append("removedMedia",JSON.stringify(o)),D.media&&D.media.length>0&&D.media.forEach((e,t)=>{n.append("addedMedia_".concat(t),e)}),n.append("addedMediaCount",String((null===(a=D.media)||void 0===a?void 0:a.length)||0));let l=await fetch("".concat(w.v.apiUrl,"/api/project/update?id=").concat(e.id),{method:"POST",headers:{Authorization:"Bearer ".concat(i)},body:n});if(!l.ok){let e="Failed to update project";try{let t=await l.text();if(console.log("Error response:",t),t)try{e=JSON.parse(t).message||e}catch(a){e=t}}catch(e){console.error("Error reading response:",e)}throw Error(e)}t.push("/my-projects")}catch(e){console.error("Submit error:",e),T([e.message||"Failed to update project"])}finally{C(!1)}};return a||k?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-50",children:(0,r.jsx)(s.Z,{size:"lg"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.Z,{}),(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 pt-16",children:(0,r.jsx)(o.Z,{className:"py-8",children:(0,r.jsx)(o.Z,{maxWidth:"md",children:(0,r.jsxs)(l.Z,{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg p-6",children:[(0,r.jsx)(c.Z,{component:"div",orientation:O,sx:{"--Stepper-verticalGap":"1rem","--Step-gap":"1rem",marginBottom:2},children:F.map((e,t)=>(0,r.jsx)(d.Z,{component:"div",indicator:(0,r.jsx)(p.Z,{variant:t<=N?"solid":"soft",color:t<=N?"primary":"neutral",children:t<N?(0,r.jsx)(h.Z,{}):t+1}),children:(0,r.jsx)(u.Z,{component:"button",onClick:()=>E(t),sx:{cursor:"pointer","&:hover":{bgcolor:"background.level1"}},children:e})},e))}),(0,r.jsxs)("div",{children:[(e=>{switch(e){case 0:return(0,r.jsx)(g.Z,{projectData:D,setProjectData:M});case 1:return(0,r.jsx)(j.Z,{projectData:D,setProjectData:M});case 2:return(0,r.jsx)(f.Z,{projectData:D,setProjectData:M,existingThumbnail:D.existingThumbnail});case 3:return(0,r.jsx)(x.Z,{projectData:D,setProjectData:M,existingMedia:D.existingMedia});case 4:return(0,r.jsx)(b.Z,{projectData:D});default:return"Unknown step"}})(N),(0,r.jsxs)("div",{className:"mt-8 flex justify-between",children:[(0,r.jsx)(m.Z,{variant:"outlined",color:"neutral",disabled:0===N,onClick:()=>{E(e=>e-1)},children:"Zpět"}),(0,r.jsx)("div",{className:"flex gap-2",children:N===F.length-1?(0,r.jsx)(m.Z,{variant:"solid",color:"primary",onClick:U,disabled:A,endDecorator:A&&(0,r.jsx)(s.Z,{size:"sm"}),children:A?"Ukl\xe1d\xe1n\xed...":"Uložit změny"}):(0,r.jsx)(m.Z,{variant:"solid",color:"primary",onClick:()=>{let e=(0,v.sc)(N,D);if(e.length>0){T(e);return}T([]),E(e=>e+1)},children:"Dalš\xed"})})]}),P.length>0&&(0,r.jsx)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:P.map((e,t)=>(0,r.jsx)("p",{className:"text-red-600",children:e},t))})]})]})})})})]})}}},function(e){e.O(0,[572,902,879,559,550,353,889,557,189,349,971,69,744],function(){return e(e.s=1441)}),_N_E=e.O()}]);