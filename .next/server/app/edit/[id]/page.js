(()=>{var e={};e.id=416,e.ids=[416],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1017:e=>{"use strict";e.exports=require("path")},7310:e=>{"use strict";e.exports=require("url")},7187:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>m,tree:()=>l});var a=r(482),i=r(9108),s=r(2563),n=r.n(s),o=r(8300),d={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);r.d(t,d);let l=["",{children:["edit",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,931)),"D:\\Cursor\\kiosek2.0\\frontend\\kiosek\\app\\edit\\[id]\\page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,7481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,2585)),"D:\\Cursor\\kiosek2.0\\frontend\\kiosek\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,7481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["D:\\Cursor\\kiosek2.0\\frontend\\kiosek\\app\\edit\\[id]\\page.tsx"],p="/edit/[id]/page",u={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/edit/[id]/page",pathname:"/edit/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},3795:(e,t,r)=>{Promise.resolve().then(r.bind(r,8869))},8869:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var a=r(5344),i=r(3729),s=r(8428),n=r(8136),o=r(918),d=r(1013),l=r(5320),c=r(2963),p=r(2946),u=r(1174),m=r(2383),g=r(3637),h=r(1507),x=r(2222),f=r(7558),j=r(8396),b=r(7903),v=r(5774),y=r(6675),k=r(8330);function w(){let e=(0,s.useParams)(),t=(0,s.useRouter)(),[r,w]=(0,i.useState)(!0),[P,S]=(0,i.useState)(!0),[Z,_]=(0,i.useState)(0),[E,D]=(0,i.useState)("horizontal"),[M,N]=(0,i.useState)({name:"",tags:[],description:"",thumbnail:null,media:[],existingThumbnail:"",existingMedia:[],originalMedia:[]}),[q,z]=(0,i.useState)([]),[O,$]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{let r=localStorage.getItem("token");if(!r){t.push("/login");return}try{if(!(await fetch(`${k.v.apiUrl}/api/auth/validateOwner?id=${e.id}`,{method:"GET",headers:{Authorization:`Bearer ${r}`}})).ok)throw Error("Invalid token");w(!1)}catch(e){t.push("/login")}})()},[t]),(0,i.useEffect)(()=>{let t=async()=>{let t=localStorage.getItem("token");try{let r=await fetch(`${k.v.apiUrl}/api/project/edit?id=${e.id}`,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw Error("Failed to fetch project");let a=await r.json();console.log("Received data:",a),N({name:a.name||"",description:a.description||"",tags:a.tags?"string"==typeof a.tags?JSON.parse(a.tags):a.tags:[],thumbnail:null,media:[],existingThumbnail:a.thumbnail?a.thumbnail.replace(/\\/g,"/"):"",existingMedia:a.media?("string"==typeof a.media?JSON.parse(a.media):a.media).map(e=>e.replace(/\\/g,"/")):[],originalMedia:a.media?("string"==typeof a.media?JSON.parse(a.media):a.media).map(e=>e.replace(/\\/g,"/")):[]}),a.tags&&"object"==typeof a.tags&&!Array.isArray(a.tags)&&(a.tags=Object.values(a.tags)),a.tags&&"object"==typeof a.tags&&!Array.isArray(a.tags)&&(a.tags=Object.values(a.tags)),S(!1)}catch(e){console.error("Fetch error:",e),z([e instanceof Error?e.message:"Failed to fetch project"]),S(!1)}};!r&&e.id&&t()},[r,e.id]),(0,i.useEffect)(()=>{let e=()=>{D(window.innerWidth<600?"vertical":"horizontal")};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let A=["N\xe1zev","Popis","Thumbnail","Media","Uk\xe1zka"],C=async()=>{if(!O)try{$(!0);let r=(0,v.Ow)(M);if(r.length>0){z(r),$(!1);return}let a=localStorage.getItem("token");if(!a){t.push("/login");return}let i=new FormData;i.append("name",M.name),i.append("description",M.description),i.append("tags",JSON.stringify(M.tags||[]));let s=null!==M.thumbnail;i.append("changedThumbnail",String(s)),M.thumbnail&&i.append("thumbnail",M.thumbnail);let n=(M.originalMedia||[]).filter(e=>!(M.existingMedia||[]).includes(e));i.append("removedMedia",JSON.stringify(n)),M.media&&M.media.length>0&&M.media.forEach((e,t)=>{i.append(`addedMedia_${t}`,e)}),i.append("addedMediaCount",String(M.media?.length||0));let o=await fetch(`${k.v.apiUrl}/api/project/update?id=${e.id}`,{method:"POST",headers:{Authorization:`Bearer ${a}`},body:i});if(!o.ok){let e="Failed to update project";try{let t=await o.text();if(console.log("Error response:",t),t)try{e=JSON.parse(t).message||e}catch(r){e=t}}catch(e){console.error("Error reading response:",e)}throw Error(e)}t.push("/my-projects")}catch(e){console.error("Submit error:",e),z([e.message||"Failed to update project"])}finally{$(!1)}};return r||P?a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-50",children:a.jsx(n.Z,{size:"lg"})}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(y.Z,{}),a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 pt-16",children:a.jsx(o.Z,{className:"py-8",children:a.jsx(o.Z,{maxWidth:"md",children:(0,a.jsxs)(d.Z,{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-lg p-6",children:[a.jsx(l.Z,{component:"div",orientation:E,sx:{"--Stepper-verticalGap":"1rem","--Step-gap":"1rem",marginBottom:2},children:A.map((e,t)=>a.jsx(c.Z,{component:"div",indicator:a.jsx(p.Z,{variant:t<=Z?"solid":"soft",color:t<=Z?"primary":"neutral",children:t<Z?a.jsx(g.Z,{}):t+1}),children:a.jsx(u.Z,{component:"button",onClick:()=>_(t),sx:{cursor:"pointer","&:hover":{bgcolor:"background.level1"}},children:e})},e))}),(0,a.jsxs)("div",{children:[(e=>{switch(e){case 0:return a.jsx(h.Z,{projectData:M,setProjectData:N});case 1:return a.jsx(x.Z,{projectData:M,setProjectData:N});case 2:return a.jsx(f.Z,{projectData:M,setProjectData:N,existingThumbnail:M.existingThumbnail});case 3:return a.jsx(j.Z,{projectData:M,setProjectData:N,existingMedia:M.existingMedia});case 4:return a.jsx(b.Z,{projectData:M});default:return"Unknown step"}})(Z),(0,a.jsxs)("div",{className:"mt-8 flex justify-between",children:[a.jsx(m.Z,{variant:"outlined",color:"neutral",disabled:0===Z,onClick:()=>{_(e=>e-1)},children:"Zpět"}),a.jsx("div",{className:"flex gap-2",children:Z===A.length-1?a.jsx(m.Z,{variant:"solid",color:"primary",onClick:C,disabled:O,endDecorator:O&&a.jsx(n.Z,{size:"sm"}),children:O?"Ukl\xe1d\xe1n\xed...":"Uložit změny"}):a.jsx(m.Z,{variant:"solid",color:"primary",onClick:()=>{let e=(0,v.sc)(Z,M);if(e.length>0){z(e);return}z([]),_(e=>e+1)},children:"Dalš\xed"})})]}),q.length>0&&a.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:q.map((e,t)=>a.jsx("p",{className:"text-red-600",children:e},t))})]})]})})})})]})}},931:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>s,__esModule:()=>i,default:()=>n});let a=(0,r(6843).createProxy)(String.raw`D:\Cursor\kiosek2.0\frontend\kiosek\app\edit\[id]\page.tsx`),{__esModule:i,$$typeof:s}=a,n=a.default}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,68,334,92,806,116,980,697,242,408],()=>r(7187));module.exports=a})();